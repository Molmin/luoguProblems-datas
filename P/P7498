===== Sample #1 Input =====
6 4 499122177
1 2
1 3
5 3
4 6
4 3
2 N 1 S
3 S 1 S
5 N 6 N
1 S 4 N
===== Sample #1 Output =====
3
6
17
11
===== Sample #2 Input =====
10 6 199648871
3 7
4 9
2 3
5 6
7 10
5 7
5 9
8 2
1 3
10 S 5 S
1 N 7 S
1 N 4 N
1 S 4 N
4 N 3 S
7 N 4 N
===== Sample #2 Output =====
332748127
8
665496262
665496261
665496253
831870314
